#!/bin/sh
. "$(dirname "$0")/_/husky.sh"
# Disable commit to main branch
branch="$(git rev-parse --abbrev-ref HEAD)"

if [ "$branch" = "main" ]; then
    echo "You can't commit directly to main branch"
    exit 1
fi
#asd

# Disable commit to branch created locally
valid_chars="^([0-9]+)-([a-z0-9-]+)$"
message='Your branch must be created from issue. e.g. 12-branch-name'

if [[ ! $branch =~ $valid_chars ]]; then
    printf '%s\n' "$message"
    exit 1
fi

echo "ğŸ” Running tests for affected Nx projects (100% coverage required)..."

npm run test:affected
RESULT=$?

if [ $RESULT -ne 0 ]; then
  echo "âŒ Commit blocked: Affected project tests failed or coverage < 100%"
  exit 1
fi

echo "âœ… All affected projects passed with 100% coverage"

